<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Requirement Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Inter;background:#0f172a;color:#e5e7eb}
.card{background:#020617;border:1px solid #1f2937;padding:18px;border-radius:16px;margin:12px}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #1f2937}
tr.dup td{background:#7c3aed22}
tr.info td{background:#0ea5e955}
td.edit{background:#0b1220}
</style>
</head>

<body>

<div class="card">
  <h2>Upload PDFs</h2>
  <form method="POST" enctype="multipart/form-data">
    <input type="file" name="pdf" multiple required>
    <button>Extract</button>
  </form>
</div>

<div class="card">
<h2>Requirements</h2>

<table>
{% if rows %}
<tr>
{% for k in rows[0].keys() if k != 'duplicate' %}
<th>{{k}}</th>
{% endfor %}
</tr>

{% for r in rows %}
<tr class="{{ 'dup' if r['duplicate'] else '' }} {{ 'info' if r['Type']=='Information only' else '' }}">
{% for k,v in r.items() if k != 'duplicate' %}
<td contenteditable="{{ 'true' if k in ['Priority','Owner','Status','Module'] else 'false' }}">
{{v}}
</td>
{% endfor %}
</tr>
{% endfor %}
{% endif %}
</table>

<br>
<a href="/export/excel"><button>Export Excel</button></a>
<a href="/export/csv"><button>Export CSV</button></a>
</div>

<div class="card">
<h2>Requirement Count Per Cadence</h2>
<canvas id="bar"></canvas>
</div>

<script>
fetch("/chart-data").then(r=>r.json()).then(d=>{
 new Chart(bar,{type:"bar",data:{labels:d.labels,datasets:[{data:d.counts}]}})
})
</script>

</body>
</html>
